# 2D 生物行走演化模擬

一個基於物理引擎的 2D 生物演化模擬專案，使用遺傳演算法讓虛擬生物學會行走。

## 專案簡介

本專案模擬了生物演化過程，透過遺傳演算法讓由骨骼和關節組成的虛擬生物逐代演化，最終學會協調肢體進行有效的移動。你將看到第一代生物在地上抽搐、翻滾，但經過數十代演化後，它們會發展出類似「兔子跳」或「人類跨步」的高效行走方式。

### 核心特色

- **真實物理模擬**：使用 Pymunk 物理引擎，提供重力、碰撞、摩擦力等真實物理效果
- **遺傳演算法**：透過選擇、交叉、突變等演化機制優化生物行為
- **雙足/四足模式**：支援兩種不同的生物類型，展現不同的演化策略
- **即時視覺化**：同時顯示多個生物的演化過程，直觀展示演化效果
- **自適應突變**：當族群多樣性降低時自動提高突變率，避免過早收斂
- **交互式配置**：啟動時可自訂核心參數，無需修改程式碼

## 安裝需求

### Python 套件

```bash
pip install pygame pymunk
```

## 使用方法

### 開始

```bash
python main.py
```

### 配置選項

啟動程式後，你可以選擇：

1. **使用預設設定** - 直接按 Enter 或輸入 `Y`，使用預設配置快速開始
2. **自訂設定** - 輸入 `n`，進入交互式配置模式

#### 可配置參數

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| 生物類型 | BIPED (雙足) 或 QUADRUPED (四足) | QUADRUPED | - |
| 族群大小 | 每一代的生物數量 | 15 | 10-30 |
| 突變率 | 基因突變的機率 | 0.2 | 0.0-1.0 |
| 突變強度 | 每次突變的幅度 | 0.2 | 0.0-1.0 |

### 執行畫面說明

程式會顯示一個視窗，分為多個小格子，每個格子顯示一個生物的模擬過程：

- **上方資訊**：生物編號、距離分數、剩餘時間
- **底部狀態列**：
  - 左側：當前世代、最佳距離、模擬時間
  - 右側：按鍵提示

### 按鍵控制

| 按鍵 | 功能 |
|------|------|
| `SPACE` | 暫停/繼續模擬 |
| `S` | 切換速度 (2x ↔ 8x) |
| `N` | 跳過當前世代，立即進入下一代 |
| `ESC` | 退出程式 |

## 專案結構

```
.
├── main.py           # 主程式，包含模擬邏輯和配置系統
├── config.py         # 配置檔案，定義所有參數
├── creature.py       # 生物類別，定義身體結構和物理行為
├── evolution.py      # 遺傳演算法實作
├── renderer.py       # 渲染系統，處理視覺化顯示
├── docs/
│   └── 方向講解.txt  # 專案設計理念說明
└── README.md         # 本文件
```

## 核心概念

### 基因編碼

每個生物的行為由一組「基因」控制，基因決定了關節馬達的運動模式：

- **振幅 (Amplitude)**：關節擺動的幅度
- **頻率 (Frequency)**：關節擺動的速度
- **相位 (Phase)**：關節之間的時間差（決定步態協調性）

每個關節馬達有 3 個基因參數，雙足生物有 4 個馬達（2條腿 × 2關節），四足生物有 8 個馬達（4條腿 × 2關節）。

### 適應度函數

生物的適應度（fitness）由以下因素決定：

1. **移動距離**：向前移動的距離（主要指標）
2. **直立獎勵**：保持直立姿勢的時間
3. **步態獎勵**：出現交替踏步動作的次數
4. **摔倒懲罰**：如果軀幹觸地會被扣分
5. **能量懲罰**：過度使用關節馬達會被輕微扣分

### 演化機制

1. **選擇 (Selection)**：適應度高的生物有更高機會成為父母
2. **交叉 (Crossover)**：兩個父母的基因混合產生後代
3. **突變 (Mutation)**：隨機修改基因，探索新的行為模式
4. **菁英保留 (Elitism)**：每代保留最優秀的個體

### 死亡條件

生物會在以下情況死亡：

- 軀幹觸地（頭朝下摔倒）
- 軀幹傾斜角度過大
- 軀幹高度過低
- 模擬時間到達上限

## 進階調整

如果你想要更深入調整演化參數，可以直接編輯 `config.py` 檔案：

### 物理參數
- `GRAVITY`：重力大小
- `MOTOR_MAX_FORCE`：關節馬達的最大力量
- `GROUND_FRICTION`：地面摩擦力

### 身體結構
- `TORSO_WIDTH/HEIGHT`：軀幹尺寸
- `THIGH_LENGTH`：大腿長度
- `SHIN_LENGTH`：小腿長度

### 演化策略
- `SELECTION_METHOD`：選擇方法 ('tournament' 或 'roulette')
- `ELITE_RATIO`：菁英保留比例
- `CROSSOVER_RATE`：交叉機率

### 適應度權重
- `FITNESS_DISTANCE_WEIGHT`：距離權重
- `FITNESS_STEP_REWARD`：踏步獎勵
- `FITNESS_FALL_PENALTY`：摔倒懲罰

## 觀察重點

### 第 1-5 代
生物行為混亂，大多數會立即摔倒或原地抽搐

### 第 10-20 代
開始出現能夠維持平衡並稍微前進的個體

### 第 30-50 代
部分生物發展出穩定的步態，能夠持續向前移動

### 第 50+ 代
演化出高效的行走模式，例如：
- 雙足：交替邁步、跳躍前進
- 四足：對角步態、飛奔姿勢

## 常見問題

### Q: 為什麼生物一直原地轉圈？
A: 這是演化初期的常見現象。增加突變率或重新開始模擬可能會產生不同結果。

### Q: 可以儲存演化結果嗎？
A: 目前版本不支援儲存，但你可以在 `evolution.py` 中實作基因序列化功能。

### Q: 如何讓演化更快？
A: 按 `S` 鍵切換到 8x 速度，或按 `N` 跳過表現不佳的世代。

### Q: 雙足和四足哪個比較容易演化出行走？
A: 通常四足生物更容易獲得穩定性，但雙足生物可能發展出更有效率的步態。

## 授權

本專案採用 MIT 授權條款。

## 致謝

- **Pymunk**：提供優秀的 2D 物理引擎
- **Pygame**：提供簡單易用的圖形介面
- **演化機器人學 (Evolutionary Robotics)**：本專案的理論基礎

## 聯絡方式

如有問題或建議，歡迎在 GitHub Issues 中討論。

---

**享受觀察生物演化的樂趣！**
